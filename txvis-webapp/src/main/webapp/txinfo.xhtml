<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

<h:head>
    <title>TxVis / Transaction Info: #{transactionInfoBean.transaction.txuid}</title>
    <h:outputStylesheet library="css" name="bootstrap.min.css"  />
</h:head>
<f:event type="preRenderView" listener="#{transactionInfoBean.init}"/>

<h:body>
    <div class="container">
        <div class="page-header">
            <h1>Transaction Visualisation Tool</h1>
        </div>
        <p><h:link value="&#171; Transaction List" outcome="txlist" /></p>
        <hr />
        <div>
            <h3>Transaction Information</h3>
            <dl class="dl-horizontal">
                <dt>Transaction UID: </dt>
                <dd>#{transactionInfoBean.transaction.txuid}</dd>
                <dt>Node ID:</dt>
                <dd>#{transactionInfoBean.transaction.jbossNodeid}</dd>
                <dt>Distributed:</dt>
                <dd>#{transactionInfoBean.transaction.distributed}</dd>
                <dt>Outcome: </dt>
                <dd>#{transactionInfoBean.transaction.status}</dd>
                <dt>Start Time: </dt>
                <dd>#{transactionInfoBean.transaction.startTime}</dd>
                <dt>End Time: </dt>
                <dd>#{transactionInfoBean.transaction.endTime}</dd>
                <dt>Duration: </dt>
                <dd>#{transactionInfoBean.transaction.duration}ms</dd>
            </dl>
        </div>
        <hr />
        <div>
            <h3>Enlisted Participants</h3>
            <h4>Resources</h4>
            <h:dataTable value="#{transactionInfoBean.transaction.participantRecords}" var="rec"
                         styleClass="table table-striped">
                <h:column>
                    <f:facet name="header">Jndi Name</f:facet>
                    #{rec.resourceManager.jndiName}
                </h:column>
                <h:column>
                    <f:facet name="header">Product Name</f:facet>
                    #{rec.resourceManager.productName}
                </h:column>
                <h:column>
                    <f:facet name="header">Product Version</f:facet>
                   #{rec.resourceManager.productVersion}
                </h:column>
                <h:column>
                    <f:facet name="header">Vote</f:facet>
                    #{rec.vote}
                </h:column>
                <h:column>
                    <f:facet name="header">XAException</f:facet>
                    #{rec.xaException}
                </h:column>
            </h:dataTable>
            <h4>Subordinate Transactions</h4>
            <h:dataTable value="#{transactionInfoBean.transaction.subordinates}" var="tx"
                         styleClass="table table-striped">
                <h:column>
                    <f:facet name="header">Node ID</f:facet>
                    <h:link value="#{tx.jbossNodeid}" outcome="txinfo" >
                        <f:param name="includeViewParams" value="true" />
                        <f:param name="txid" value="#{tx.id}" />
                    </h:link>

                </h:column>
                <h:column>
                    <f:facet name="header">Outcome</f:facet>
                    #{tx.status}
                </h:column>
            </h:dataTable>
        </div>
        <hr />
        <div>
            <h3>Event Timeline</h3>
            <h:dataTable value="#{transactionInfoBean.transaction.eventsInTemporalOrder}" var="event"
                         styleClass="table table-striped">
                <h:column>
                    <f:facet name="header">Time</f:facet>
                    #{event.timestamp}
                </h:column>
                <h:column>
                    <f:facet name="header">Event</f:facet>
                    #{event.eventType}
                </h:column>
                <h:column>
                    <f:facet name="header">Actor</f:facet>
                    #{event.eventEntity}
                </h:column>
            </h:dataTable>
        </div>
        <hr />
        <p><h:link value="&#171; Transaction List" outcome="txlist" /></p>
        <hr />
    </div>

    <h:outputScript library="js" name="jquery-1.9.1.min.js" />
    <h:outputScript library="js" name="bootstrap.min.js" />
</h:body>
</html>
